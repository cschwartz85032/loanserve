> rest-express@1.0.0 dev
> NODE_ENV=development tsx server/index.ts

[RabbitMQ] Establishing connections...
[INFO] Successfully loaded pdf2pic module
Warning: Cannot polyfill `DOMMatrix`, rendering may be broken: "Error: libuuid.so.1: cannot open shared object file: No such file or directory".
Warning: Cannot polyfill `Path2D`, rendering may be broken: "Error: libuuid.so.1: cannot open shared object file: No such file or directory".
[INFO] Successfully loaded pdfjs-dist module
[Migration] Starting database migrations...
[Migration] Error running migrations: error: type "collection_status" already exists
    at file:///home/runner/workspace/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async migrate (/home/runner/workspace/node_modules/src/neon-http/migrator.ts:45:5)
    at async runMigrations (/home/runner/workspace/server/migrations.ts:13:5)
    at async <anonymous> (/home/runner/workspace/server/index.ts:80:3) {
  length: 97,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1167',
  routine: 'DefineEnum'
}
[Consumers] Starting payment processing consumers...
[Consumers] Waiting for RabbitMQ connection...
[RabbitMQ] Applying topology...
[RabbitMQ] Exchange declared: servicing.direct (direct)
[RabbitMQ] Exchange declared: payments.topic (topic)
[RabbitMQ] Exchange declared: documents.direct (direct)
[RabbitMQ] Exchange declared: notifications.topic (topic)
[RabbitMQ] Exchange declared: escrow.workflow (topic)
[RabbitMQ] Exchange declared: escrow.compensate (topic)
[RabbitMQ] Exchange declared: compliance.topic (topic)
[RabbitMQ] Exchange declared: investor.direct (direct)
[RabbitMQ] Exchange declared: audit.topic (topic)
[RabbitMQ] Exchange declared: settlement.topic (topic)
[RabbitMQ] Exchange declared: reconciliation.topic (topic)
[RabbitMQ] Exchange declared: bank.topic (topic)
[RabbitMQ] Exchange declared: aml.topic (topic)
[RabbitMQ] Exchange declared: dlx.main (topic)
[RabbitMQ] Exchange declared: retry.5s (topic)
[RabbitMQ] Exchange declared: retry.30s (topic)
[RabbitMQ] Queue declared: servicing.daily.tasks.0
[RabbitMQ] Bound servicing.daily.tasks.0 to servicing.direct with key servicing.0.*
[RabbitMQ] Queue declared: servicing.daily.tasks.1
[RabbitMQ] Bound servicing.daily.tasks.1 to servicing.direct with key servicing.1.*
[RabbitMQ] Queue declared: servicing.daily.tasks.2
[RabbitMQ] Bound servicing.daily.tasks.2 to servicing.direct with key servicing.2.*
[RabbitMQ] Queue declared: servicing.daily.tasks.3
[RabbitMQ] Bound servicing.daily.tasks.3 to servicing.direct with key servicing.3.*
[RabbitMQ] Queue declared: servicing.daily.tasks.4
[RabbitMQ] Bound servicing.daily.tasks.4 to servicing.direct with key servicing.4.*
[RabbitMQ] Queue declared: servicing.daily.tasks.5
[RabbitMQ] Bound servicing.daily.tasks.5 to servicing.direct with key servicing.5.*
[RabbitMQ] Queue declared: servicing.daily.tasks.6
[RabbitMQ] Bound servicing.daily.tasks.6 to servicing.direct with key servicing.6.*
[RabbitMQ] Queue declared: servicing.daily.tasks.7
[RabbitMQ] Bound servicing.daily.tasks.7 to servicing.direct with key servicing.7.*
[RabbitMQ] Queue declared: payments.validation
[RabbitMQ] Bound payments.validation to payments.topic with key payment.*.received
[RabbitMQ] Queue declared: payments.processing
[RabbitMQ] Bound payments.processing to payments.topic with key payment.*.validated
[RabbitMQ] Queue declared: payments.distribution
[RabbitMQ] Bound payments.distribution to payments.topic with key payment.*.processed
[RabbitMQ] Queue declared: payments.compliance
[RabbitMQ] Bound payments.compliance to payments.topic with key payment.*.compliance
[RabbitMQ] Queue declared: payments.reversal
[RabbitMQ] Bound payments.reversal to payments.topic with key payment.*.reversal
[RabbitMQ] Queue declared: payments.returned
[RabbitMQ] Bound payments.returned to payments.topic with key payment.*.returned
[RabbitMQ] Queue declared: documents.analysis.request
[RabbitMQ] Bound documents.analysis.request to documents.direct with key analyze
[RabbitMQ] Queue declared: notifications.email
[RabbitMQ] Bound notifications.email to notifications.topic with key notify.*.*.email
[RabbitMQ] Queue declared: notifications.sms
[RabbitMQ] Bound notifications.sms to notifications.topic with key notify.*.*.sms
[RabbitMQ] Queue declared: notifications.dashboard
[RabbitMQ] Bound notifications.dashboard to notifications.topic with key notify.*.*.dashboard
[RabbitMQ] Queue declared: escrow.validate
[RabbitMQ] Bound escrow.validate to escrow.workflow with key escrow.validate
[RabbitMQ] Queue declared: escrow.authorize
[RabbitMQ] Bound escrow.authorize to escrow.workflow with key escrow.authorize
[RabbitMQ] Queue declared: escrow.disburse
[RabbitMQ] Bound escrow.disburse to escrow.workflow with key escrow.disburse
[RabbitMQ] Queue declared: escrow.reconcile
[RabbitMQ] Bound escrow.reconcile to escrow.workflow with key escrow.reconcile
[RabbitMQ] Queue declared: compliance.regulatory
[RabbitMQ] Bound compliance.regulatory to compliance.topic with key compliance.regulatory.*
[RabbitMQ] Queue declared: compliance.investor
[RabbitMQ] Bound compliance.investor to compliance.topic with key compliance.investor.*
[RabbitMQ] Queue declared: compliance.internal
[RabbitMQ] Bound compliance.internal to compliance.topic with key compliance.internal.*
[RabbitMQ] Queue declared: investor.calc.p10
[RabbitMQ] Bound investor.calc.p10 to investor.direct with key calc.p10
[RabbitMQ] Queue declared: investor.calc.p5
[RabbitMQ] Bound investor.calc.p5 to investor.direct with key calc.p5
[RabbitMQ] Queue declared: investor.calc.p1
[RabbitMQ] Bound investor.calc.p1 to investor.direct with key calc.p1
[RabbitMQ] Queue declared: investor.clawback
[RabbitMQ] Bound investor.clawback to investor.direct with key clawback
[RabbitMQ] Queue declared: audit.events
[RabbitMQ] Bound audit.events to audit.topic with key audit.*
[RabbitMQ] Queue declared: settlement.ach.settle
[RabbitMQ] Bound settlement.ach.settle to settlement.topic with key ach.settlement.*
[RabbitMQ] Queue declared: settlement.ach.return
[RabbitMQ] Bound settlement.ach.return to settlement.topic with key ach.return.*
[RabbitMQ] Queue declared: settlement.wire.advice
[RabbitMQ] Bound settlement.wire.advice to settlement.topic with key wire.advice.*
[RabbitMQ] Queue declared: settlement.check.clear
[RabbitMQ] Bound settlement.check.clear to settlement.topic with key check.clear.*
[RabbitMQ] Queue declared: reconciliation.bank.import
[RabbitMQ] Bound reconciliation.bank.import to bank.topic with key bank.file.*
[RabbitMQ] Queue declared: reconciliation.match
[RabbitMQ] Bound reconciliation.match to reconciliation.topic with key match.*
[RabbitMQ] Queue declared: reconciliation.exceptions
[RabbitMQ] Bound reconciliation.exceptions to reconciliation.topic with key exception.*
[RabbitMQ] Queue declared: compliance.hits
[RabbitMQ] Bound compliance.hits to compliance.topic with key compliance.hit.*
[RabbitMQ] Queue declared: aml.screen
[RabbitMQ] Bound aml.screen to aml.topic with key screen.*
[RabbitMQ] Queue declared: aml.review
[RabbitMQ] Bound aml.review to aml.topic with key review.*
[RabbitMQ] Queue declared: dlq.payments
[RabbitMQ] Bound dlq.payments to dlx.main with key payments.dlq
[RabbitMQ] Queue declared: dlq.documents
[RabbitMQ] Bound dlq.documents to dlx.main with key documents.dlq
[RabbitMQ] Queue declared: dlq.notifications
[RabbitMQ] Bound dlq.notifications to dlx.main with key notifications.dlq
[RabbitMQ] Queue declared: dlq.settlement
[RabbitMQ] Bound dlq.settlement to dlx.main with key settlement.dlq
[RabbitMQ] Queue declared: dlq.reconciliation
[RabbitMQ] Bound dlq.reconciliation to dlx.main with key reconciliation.dlq
[RabbitMQ] Queue declared: dlq.compliance
[RabbitMQ] Bound dlq.compliance to dlx.main with key compliance.dlq
[RabbitMQ] Queue declared: dlq.aml
[RabbitMQ] Bound dlq.aml to dlx.main with key aml.dlq
[RabbitMQ] Queue declared: dlq.servicing.0
[RabbitMQ] Bound dlq.servicing.0 to dlx.main with key servicing.dlq.0
[RabbitMQ] Queue declared: dlq.servicing.1
[RabbitMQ] Bound dlq.servicing.1 to dlx.main with key servicing.dlq.1
[RabbitMQ] Queue declared: dlq.servicing.2
[RabbitMQ] Bound dlq.servicing.2 to dlx.main with key servicing.dlq.2
[RabbitMQ] Queue declared: dlq.servicing.3
[RabbitMQ] Bound dlq.servicing.3 to dlx.main with key servicing.dlq.3
[RabbitMQ] Queue declared: dlq.servicing.4
[RabbitMQ] Bound dlq.servicing.4 to dlx.main with key servicing.dlq.4
[RabbitMQ] Queue declared: dlq.servicing.5
[RabbitMQ] Bound dlq.servicing.5 to dlx.main with key servicing.dlq.5
[RabbitMQ] Queue declared: dlq.servicing.6
[RabbitMQ] Bound dlq.servicing.6 to dlx.main with key servicing.dlq.6
[RabbitMQ] Queue declared: dlq.servicing.7
[RabbitMQ] Bound dlq.servicing.7 to dlx.main with key servicing.dlq.7
[RabbitMQ] Topology applied successfully
[RabbitMQ] Successfully connected and topology applied
[RabbitMQ] Topology stats: {
  exchanges: 16,
  queues: 55,
  quorumQueues: 35,
  lazyQueues: 3,
  dlqs: 15
}
[RabbitMQ] Connection ready
[Consumers] RabbitMQ connected
[RabbitMQ] Consumer started: payment-validation-consumer on queue payments.validation
[Validation] Payment validation consumer started
[Consumers] Validation consumer started
[RabbitMQ] Consumer started: payment-processing-consumer on queue payments.processing
[Processing] Payment processing consumer started
[Consumers] Processing consumer started
[RabbitMQ] Consumer started: payment-distribution-consumer on queue payments.distribution
[RabbitMQ] Consumer started: payment-clawback-consumer on queue investor.clawback
[Distribution] Payment distribution consumer started
[Consumers] Distribution consumer started
[RabbitMQ] Consumer started: payment-reversal-consumer on queue payments.reversal
[RabbitMQ] Consumer started: ach-return-consumer on queue payments.returned
[Reversal] Payment reversal saga started
[Consumers] Reversal saga started
[Consumers] All payment processing consumers started successfully
[Server] Payment consumers started successfully
5:25:46 AM [express] serving on port 5000
[Payment Details] Error fetching payment: error: column lb.is_primary does not exist
    at file:///home/runner/workspace/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async <anonymous> (/home/runner/workspace/server/routes/payment-management.ts:350:29) {
  length: 112,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '250',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'parse_relation.c',
  line: '3722',
  routine: 'errorMissingColumn'
}
[Payment Details] Error fetching payment: error: column lb.is_primary does not exist
    at file:///home/runner/workspace/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async <anonymous> (/home/runner/workspace/server/routes/payment-management.ts:350:29) {
  length: 112,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '250',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'parse_relation.c',
  line: '3722',
  routine: 'errorMissingColumn'
}
[RateLimiter] IP buckets: 0, Email buckets: 0
[Payment Details] Error fetching payment: error: column lb.is_primary does not exist
    at file:///home/runner/workspace/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async <anonymous> (/home/runner/workspace/server/routes/payment-management.ts:350:29) {
  length: 112,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '250',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'parse_relation.c',
  line: '3722',
  routine: 'errorMissingColumn'
}
