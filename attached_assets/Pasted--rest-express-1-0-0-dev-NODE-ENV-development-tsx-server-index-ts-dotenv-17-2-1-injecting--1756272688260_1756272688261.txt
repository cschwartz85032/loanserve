
> rest-express@1.0.0 dev
> NODE_ENV=development tsx server/index.ts

[dotenv@17.2.1] injecting env (4) from .env.local -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit
[Twilio] Creating service instance...
[Twilio] Checking configuration...
[Twilio] Account SID: Present
[Twilio] Auth Token: Present
[Twilio] Phone Number: +12023017979
[Twilio] Messaging Service SID: MG695e1b1cd14f6b2fb31fa6db23d8a05b
[Twilio] ‚úì Service configured successfully with phone: +12023017979
[RabbitMQ] Establishing connections...
[RabbitMQ] Establishing connections...
[INFO] Successfully loaded pdf2pic module
Warning: Cannot polyfill `DOMMatrix`, rendering may be broken: "Error: libuuid.so.1: cannot open shared object file: No such file or directory".
Warning: Cannot polyfill `Path2D`, rendering may be broken: "Error: libuuid.so.1: cannot open shared object file: No such file or directory".
[INFO] Successfully loaded pdfjs-dist module
[dotenv@17.2.1] injecting env (0) from .env.local -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
[Config] Loaded .env.local
[Telemetry] Initializing observability...
[Telemetry] Service: loanserve-pro
[Telemetry] Version: 1.0.0
[Telemetry] Environment: development
[Migration] Starting database migrations...
[Migration] Error running migrations: error: type "collection_status" already exists
    at file:///home/runner/workspace/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async migrate (/home/runner/workspace/node_modules/src/neon-http/migrator.ts:45:5)
    at async runMigrations (/home/runner/workspace/server/migrations.ts:13:5)
    at async <anonymous> (/home/runner/workspace/server/index.ts:100:3) {
  length: 97,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1167',
  routine: 'DefineEnum'
}
[Server] About to run startup validations...
[SchemaValidator] Starting validation process...
[SchemaValidator] Running startup validations...
[SchemaValidator] Environment variables validated
[SchemaValidator] Starting schema validation...
[SchemaValidator] Schema validation warnings:
  - Table 'accounts_chart' exists in database but not defined in schema
  - Table 'ach_batch' exists in database but not defined in schema
  - Table 'ach_entry' exists in database but not defined in schema
  - Table 'ach_return' exists in database but not defined in schema
  - Table 'ach_return_windows' exists in database but not defined in schema
  - Table 'allocation_rules' exists in database but not defined in schema
  - Table 'aml_screenings' exists in database but not defined in schema
  - Table 'attorney' exists in database but not defined in schema
  - Table 'audit_log' exists in database but not defined in schema
  - Table 'audit_logs' exists in database but not defined in schema
  - Table 'auth_events' exists in database but not defined in schema
  - Table 'bank_account' exists in database but not defined in schema
  - Table 'bank_files' exists in database but not defined in schema
  - Table 'bank_statement_file' exists in database but not defined in schema
  - Table 'bank_transactions' exists in database but not defined in schema
  - Table 'bank_txn' exists in database but not defined in schema
  - Table 'borrower_entities' exists in database but not defined in schema
  - Table 'borrower_notices' exists in database but not defined in schema
  - Table 'borrower_payment_methods' exists in database but not defined in schema
  - Table 'borrower_preferences' exists in database but not defined in schema
  - Table 'borrower_users' exists in database but not defined in schema
  - Table 'cash_match_candidate' exists in database but not defined in schema
  - Table 'collection_activities' exists in database but not defined in schema
  - Table 'collection_case' exists in database but not defined in schema
  - Table 'consumer_inbox' exists in database but not defined in schema
  - Table 'crm_activity' exists in database but not defined in schema
  - Table 'crm_appointments' exists in database but not defined in schema
  - Table 'crm_calls' exists in database but not defined in schema
  - Table 'crm_collaborators' exists in database but not defined in schema
  - Table 'crm_deals' exists in database but not defined in schema
  - Table 'crm_notes' exists in database but not defined in schema
  - Table 'crm_tasks' exists in database but not defined in schema
  - Table 'currency_codes' exists in database but not defined in schema
  - Table 'dead_letter_messages' exists in database but not defined in schema
  - Table 'delinquency_current' exists in database but not defined in schema
  - Table 'delinquency_snapshot' exists in database but not defined in schema
  - Table 'document_artifact' exists in database but not defined in schema
  - Table 'document_template' exists in database but not defined in schema
  - Table 'document_templates' exists in database but not defined in schema
  - Table 'documents' exists in database but not defined in schema
  - Table 'email_template_folders' exists in database but not defined in schema
  - Table 'email_templates' exists in database but not defined in schema
  - Table 'escrow_accounts' exists in database but not defined in schema
  - Table 'escrow_advances' exists in database but not defined in schema
  - Table 'escrow_analysis' exists in database but not defined in schema
  - Table 'escrow_analysis_item' exists in database but not defined in schema
  - Table 'escrow_disbursement' exists in database but not defined in schema
  - Table 'escrow_disbursement_payments' exists in database but not defined in schema
  - Table 'escrow_disbursements' exists in database but not defined in schema
  - Table 'escrow_forecast' exists in database but not defined in schema
  - Table 'escrow_items' exists in database but not defined in schema
  - Table 'escrow_ledger' exists in database but not defined in schema
  - Table 'escrow_policy' exists in database but not defined in schema
  - Table 'escrow_statement' exists in database but not defined in schema
  - Table 'escrow_transactions' exists in database but not defined in schema
  - Table 'exception_cases' exists in database but not defined in schema
  - Table 'expected_settlements' exists in database but not defined in schema
  - Table 'fee_policy' exists in database but not defined in schema
  - Table 'fee_templates' exists in database but not defined in schema
  - Table 'foreclosure_case' exists in database but not defined in schema
  - Table 'foreclosure_event' exists in database but not defined in schema
  - Table 'gateway_provider' exists in database but not defined in schema
  - Table 'general_ledger_entries' exists in database but not defined in schema
  - Table 'general_ledger_events' exists in database but not defined in schema
  - Table 'guarantors' exists in database but not defined in schema
  - Table 'idempotency_key' exists in database but not defined in schema
  - Table 'inbox' exists in database but not defined in schema
  - Table 'insurance_policies' exists in database but not defined in schema
  - Table 'interest_accruals' exists in database but not defined in schema
  - Table 'investor_contract' exists in database but not defined in schema
  - Table 'investor_distributions' exists in database but not defined in schema
  - Table 'investor_position_versions' exists in database but not defined in schema
  - Table 'investor_positions' exists in database but not defined in schema
  - Table 'investor_waterfall_rule' exists in database but not defined in schema
  - Table 'investors' exists in database but not defined in schema
  - Table 'irs_1098_records' exists in database but not defined in schema
  - Table 'late_fee_assessment' exists in database but not defined in schema
  - Table 'ledger_entries_legacy' exists in database but not defined in schema
  - Table 'ledger_entry' exists in database but not defined in schema
  - Table 'ledger_event' exists in database but not defined in schema
  - Table 'legal_proceedings' exists in database but not defined in schema
  - Table 'lender_entity' exists in database but not defined in schema
  - Table 'loan_accounting_config' exists in database but not defined in schema
  - Table 'loan_balances' exists in database but not defined in schema
  - Table 'loan_borrower_links' exists in database but not defined in schema
  - Table 'loan_borrowers' exists in database but not defined in schema
  - Table 'loan_fees' exists in database but not defined in schema
  - Table 'loan_ledger' exists in database but not defined in schema
  - Table 'loan_terms' exists in database but not defined in schema
  - Table 'loans' exists in database but not defined in schema
  - Table 'login_attempts' exists in database but not defined in schema
  - Table 'message_metrics' exists in database but not defined in schema
  - Table 'mfa_audit_log' exists in database but not defined in schema
  - Table 'mfa_backup_codes' exists in database but not defined in schema
  - Table 'mfa_challenges' exists in database but not defined in schema
  - Table 'notice_schedule' exists in database but not defined in schema
  - Table 'notice_template_v2' exists in database but not defined in schema
  - Table 'notifications' exists in database but not defined in schema
  - Table 'outbox' exists in database but not defined in schema
  - Table 'outbox_events' exists in database but not defined in schema
  - Table 'outbox_messages' exists in database but not defined in schema
  - Table 'password_reset_tokens' exists in database but not defined in schema
  - Table 'payees' exists in database but not defined in schema
  - Table 'payment_artifacts' exists in database but not defined in schema
  - Table 'payment_distributions' exists in database but not defined in schema
  - Table 'payment_events' exists in database but not defined in schema
  - Table 'payment_ingestion' exists in database but not defined in schema
  - Table 'payment_ingestions' exists in database but not defined in schema
  - Table 'payment_intake' exists in database but not defined in schema
  - Table 'payment_ledger' exists in database but not defined in schema
  - Table 'payment_posting' exists in database but not defined in schema
  - Table 'payment_schedule' exists in database but not defined in schema
  - Table 'payment_state_transitions' exists in database but not defined in schema
  - Table 'payment_transactions' exists in database but not defined in schema
  - Table 'payment_validation' exists in database but not defined in schema
  - Table 'payments' exists in database but not defined in schema
  - Table 'payments_inbox' exists in database but not defined in schema
  - Table 'permissions' exists in database but not defined in schema
  - Table 'plan_header' exists in database but not defined in schema
  - Table 'plan_progress' exists in database but not defined in schema
  - Table 'plan_schedule' exists in database but not defined in schema
  - Table 'product_policy' exists in database but not defined in schema
  - Table 'properties' exists in database but not defined in schema
  - Table 'recon_exception' exists in database but not defined in schema
  - Table 'reconciliation_exceptions' exists in database but not defined in schema
  - Table 'reconciliation_matches' exists in database but not defined in schema
  - Table 'reconciliations' exists in database but not defined in schema
  - Table 'remittance_cycle' exists in database but not defined in schema
  - Table 'remittance_export' exists in database but not defined in schema
  - Table 'remittance_item' exists in database but not defined in schema
  - Table 'remittance_recon_snapshot' exists in database but not defined in schema
  - Table 'role_permissions' exists in database but not defined in schema
  - Table 'roles' exists in database but not defined in schema
  - Table 'saga_states' exists in database but not defined in schema
  - Table 'saga_step_history' exists in database but not defined in schema
  - Table 'schedule_plan' exists in database but not defined in schema
  - Table 'schedule_row' exists in database but not defined in schema
  - Table 'servicing_events' exists in database but not defined in schema
  - Table 'servicing_exceptions' exists in database but not defined in schema
  - Table 'servicing_instructions' exists in database but not defined in schema
  - Table 'servicing_runs' exists in database but not defined in schema
  - Table 'session' exists in database but not defined in schema
  - Table 'sessions' exists in database but not defined in schema
  - Table 'settlement_windows' exists in database but not defined in schema
  - Table 'system_alerts' exists in database but not defined in schema
  - Table 'system_settings' exists in database but not defined in schema
  - Table 'tasks' exists in database but not defined in schema
  - Table 'user_ip_allowlist' exists in database but not defined in schema
  - Table 'user_mfa_factors' exists in database but not defined in schema
  - Table 'user_roles' exists in database but not defined in schema
  - Table 'users' exists in database but not defined in schema
[SchemaValidator] Startup validations complete
[Server] Startup validations completed
[Consumers] Starting payment processing consumers...
[Consumers] Waiting for RabbitMQ connection...
[RabbitMQ] Applying topology...
[RabbitMQ] Exchange declared: servicing.direct (direct)
[RabbitMQ] Exchange declared: payments.topic (topic)
[RabbitMQ] Exchange declared: documents.direct (direct)
[RabbitMQ] Exchange declared: notifications.topic (topic)
[RabbitMQ] Exchange declared: escrow.workflow (topic)
[RabbitMQ] Applying topology...
[RabbitMQ] Exchange declared: escrow.compensate (topic)
[RabbitMQ] Exchange declared: servicing.direct (direct)
[RabbitMQ] Exchange declared: escrow.saga (topic)
[RabbitMQ] Exchange declared: payments.topic (topic)
[RabbitMQ] Exchange declared: escrow.events (topic)
[RabbitMQ] Exchange declared: documents.direct (direct)
[RabbitMQ] Exchange declared: escrow.dlq (direct)
[RabbitMQ] Exchange declared: notifications.topic (topic)
[RabbitMQ] Exchange declared: compliance.topic (topic)
[RabbitMQ] Exchange declared: escrow.workflow (topic)
[RabbitMQ] Exchange declared: investor.direct (direct)
[RabbitMQ] Exchange declared: escrow.compensate (topic)
[RabbitMQ] Exchange declared: audit.topic (topic)
[RabbitMQ] Exchange declared: escrow.saga (topic)
[RabbitMQ] Exchange declared: cash.events (topic)
[RabbitMQ] Exchange declared: escrow.events (topic)
[RabbitMQ] Exchange declared: remittance (topic)
[RabbitMQ] Exchange declared: escrow.dlq (direct)
[RabbitMQ] Exchange declared: remit.saga (topic)
[RabbitMQ] Exchange declared: compliance.topic (topic)
[RabbitMQ] Exchange declared: remit.events (topic)
[RabbitMQ] Exchange declared: investor.direct (direct)
[RabbitMQ] Exchange declared: remit.dlq (direct)
[RabbitMQ] Exchange declared: audit.topic (topic)
[RabbitMQ] Exchange declared: settlement.topic (topic)
[RabbitMQ] Exchange declared: cash.events (topic)
[RabbitMQ] Exchange declared: reconciliation.topic (topic)
[RabbitMQ] Exchange declared: remittance (topic)
[RabbitMQ] Exchange declared: bank.topic (topic)
[RabbitMQ] Exchange declared: remit.saga (topic)
[RabbitMQ] Exchange declared: aml.topic (topic)
[RabbitMQ] Exchange declared: remit.events (topic)
[RabbitMQ] Exchange declared: dlx.main (topic)
[RabbitMQ] Exchange declared: remit.dlq (direct)
[RabbitMQ] Exchange declared: retry.5s (topic)
[RabbitMQ] Exchange declared: settlement.topic (topic)
[RabbitMQ] Exchange declared: retry.30s (topic)
[RabbitMQ] Exchange declared: reconciliation.topic (topic)
[RabbitMQ] Exchange declared: payments.dlq (direct)
[RabbitMQ] Exchange declared: bank.topic (topic)
[RabbitMQ] Queue declared: servicing.daily.tasks.0
[RabbitMQ] Exchange declared: aml.topic (topic)
[RabbitMQ] Bound servicing.daily.tasks.0 to servicing.direct with key servicing.0.*
[RabbitMQ] Exchange declared: dlx.main (topic)
[RabbitMQ] Queue declared: servicing.daily.tasks.1
[RabbitMQ] Exchange declared: retry.5s (topic)
[RabbitMQ] Bound servicing.daily.tasks.1 to servicing.direct with key servicing.1.*
[RabbitMQ] Exchange declared: retry.30s (topic)
[RabbitMQ] Queue declared: servicing.daily.tasks.2
[RabbitMQ] Exchange declared: payments.dlq (direct)
[RabbitMQ] Bound servicing.daily.tasks.2 to servicing.direct with key servicing.2.*
[RabbitMQ] Queue declared: servicing.daily.tasks.0
[RabbitMQ] Queue declared: servicing.daily.tasks.3
[RabbitMQ] Bound servicing.daily.tasks.0 to servicing.direct with key servicing.0.*
[RabbitMQ] Bound servicing.daily.tasks.3 to servicing.direct with key servicing.3.*
[RabbitMQ] Queue declared: servicing.daily.tasks.1
[RabbitMQ] Queue declared: servicing.daily.tasks.4
[RabbitMQ] Bound servicing.daily.tasks.1 to servicing.direct with key servicing.1.*
[RabbitMQ] Bound servicing.daily.tasks.4 to servicing.direct with key servicing.4.*
[RabbitMQ] Queue declared: servicing.daily.tasks.2
[RabbitMQ] Queue declared: servicing.daily.tasks.5
[RabbitMQ] Bound servicing.daily.tasks.2 to servicing.direct with key servicing.2.*
[RabbitMQ] Bound servicing.daily.tasks.5 to servicing.direct with key servicing.5.*
[RabbitMQ] Queue declared: servicing.daily.tasks.3
[RabbitMQ] Queue declared: servicing.daily.tasks.6
[RabbitMQ] Bound servicing.daily.tasks.3 to servicing.direct with key servicing.3.*
[RabbitMQ] Bound servicing.daily.tasks.6 to servicing.direct with key servicing.6.*
[RabbitMQ] Queue declared: servicing.daily.tasks.4
[RabbitMQ] Queue declared: servicing.daily.tasks.7
[RabbitMQ] Bound servicing.daily.tasks.4 to servicing.direct with key servicing.4.*
[RabbitMQ] Bound servicing.daily.tasks.7 to servicing.direct with key servicing.7.*
[RabbitMQ] Queue declared: servicing.daily.tasks.5
[RabbitMQ] Queue declared: payments.validation
[RabbitMQ] Bound servicing.daily.tasks.5 to servicing.direct with key servicing.5.*
[RabbitMQ] Bound payments.validation to payments.topic with key payment.*.received
[RabbitMQ] Queue declared: servicing.daily.tasks.6
[RabbitMQ] Queue declared: payments.processing
[RabbitMQ] Bound servicing.daily.tasks.6 to servicing.direct with key servicing.6.*
[RabbitMQ] Bound payments.processing to payments.topic with key payment.*.validated
[RabbitMQ] Queue declared: servicing.daily.tasks.7
[RabbitMQ] Bound payments.processing to payments.topic with key payment.*.process
[RabbitMQ] Bound servicing.daily.tasks.7 to servicing.direct with key servicing.7.*
[RabbitMQ] Queue declared: payments.distribution
[RabbitMQ] Queue declared: payments.validation
[RabbitMQ] Bound payments.distribution to payments.topic with key payment.*.processed
[RabbitMQ] Bound payments.validation to payments.topic with key payment.*.received
[RabbitMQ] Queue declared: payments.compliance
[RabbitMQ] Queue declared: payments.processing
[RabbitMQ] Bound payments.compliance to payments.topic with key payment.*.compliance
[RabbitMQ] Bound payments.processing to payments.topic with key payment.*.validated
[RabbitMQ] Queue declared: payments.reversal
[RabbitMQ] Bound payments.processing to payments.topic with key payment.*.process
[RabbitMQ] Bound payments.reversal to payments.topic with key payment.*.reversal
[RabbitMQ] Queue declared: payments.distribution
[RabbitMQ] Queue declared: payments.returned
[RabbitMQ] Bound payments.distribution to payments.topic with key payment.*.processed
[RabbitMQ] Bound payments.returned to payments.topic with key payment.*.returned
[RabbitMQ] Queue declared: payments.compliance
[RabbitMQ] Queue declared: documents.analysis.request
[RabbitMQ] Bound payments.compliance to payments.topic with key payment.*.compliance
[RabbitMQ] Bound documents.analysis.request to documents.direct with key analyze
[RabbitMQ] Queue declared: payments.reversal
[RabbitMQ] Queue declared: notifications.email
[RabbitMQ] Bound payments.reversal to payments.topic with key payment.*.reversal
[RabbitMQ] Bound notifications.email to notifications.topic with key notify.*.*.email
[RabbitMQ] Queue declared: payments.returned
[RabbitMQ] Queue declared: notifications.sms
[RabbitMQ] Bound payments.returned to payments.topic with key payment.*.returned
[RabbitMQ] Bound notifications.sms to notifications.topic with key notify.*.*.sms
[RabbitMQ] Queue declared: documents.analysis.request
[RabbitMQ] Queue declared: notifications.dashboard
[RabbitMQ] Bound documents.analysis.request to documents.direct with key analyze
[RabbitMQ] Bound notifications.dashboard to notifications.topic with key notify.*.*.dashboard
[RabbitMQ] Queue declared: notifications.email
[RabbitMQ] Queue declared: escrow.validate
[RabbitMQ] Bound notifications.email to notifications.topic with key notify.*.*.email
[RabbitMQ] Bound escrow.validate to escrow.workflow with key escrow.validate
[RabbitMQ] Queue declared: notifications.sms
[RabbitMQ] Queue declared: escrow.authorize
[RabbitMQ] Bound notifications.sms to notifications.topic with key notify.*.*.sms
[RabbitMQ] Bound escrow.authorize to escrow.workflow with key escrow.authorize
[RabbitMQ] Queue declared: notifications.dashboard
[RabbitMQ] Queue declared: escrow.disburse
[RabbitMQ] Bound notifications.dashboard to notifications.topic with key notify.*.*.dashboard
[RabbitMQ] Bound escrow.disburse to escrow.workflow with key escrow.disburse
[RabbitMQ] Queue declared: escrow.validate
[RabbitMQ] Queue declared: escrow.reconcile
[RabbitMQ] Bound escrow.validate to escrow.workflow with key escrow.validate
[RabbitMQ] Bound escrow.reconcile to escrow.workflow with key escrow.reconcile
[RabbitMQ] Queue declared: escrow.authorize
[RabbitMQ] Queue declared: q.escrow.forecast.v2
[RabbitMQ] Bound escrow.authorize to escrow.workflow with key escrow.authorize
[RabbitMQ] Bound q.escrow.forecast.v2 to escrow.saga with key forecast.request.v1
[RabbitMQ] Queue declared: escrow.disburse
[RabbitMQ] Queue declared: q.escrow.disburse.schedule.v2
[RabbitMQ] Bound escrow.disburse to escrow.workflow with key escrow.disburse
[RabbitMQ] Bound q.escrow.disburse.schedule.v2 to escrow.saga with key disbursement.schedule.v1
[RabbitMQ] Queue declared: escrow.reconcile
[RabbitMQ] Queue declared: q.escrow.disburse.post.v2
[RabbitMQ] Bound escrow.reconcile to escrow.workflow with key escrow.reconcile
[RabbitMQ] Bound q.escrow.disburse.post.v2 to escrow.saga with key disbursement.post.v1
[RabbitMQ] Queue declared: q.escrow.forecast.v2
[RabbitMQ] Queue declared: q.escrow.analysis.run.v2
[RabbitMQ] Bound q.escrow.forecast.v2 to escrow.saga with key forecast.request.v1
[RabbitMQ] Bound q.escrow.analysis.run.v2 to escrow.saga with key analysis.run.v1
[RabbitMQ] Queue declared: q.escrow.disburse.schedule.v2
[RabbitMQ] Queue declared: q.escrow.events.audit.v2
[RabbitMQ] Bound q.escrow.disburse.schedule.v2 to escrow.saga with key disbursement.schedule.v1
[RabbitMQ] Bound q.escrow.events.audit.v2 to escrow.events with key escrow.*
[RabbitMQ] Queue declared: q.escrow.disburse.post.v2
[RabbitMQ] Queue declared: q.escrow.dlq.v2
[RabbitMQ] Bound q.escrow.disburse.post.v2 to escrow.saga with key disbursement.post.v1
[RabbitMQ] Bound q.escrow.dlq.v2 to escrow.dlq with key #
[RabbitMQ] Queue declared: q.escrow.analysis.run.v2
[RabbitMQ] Queue declared: q.remit.aggregate
[RabbitMQ] Bound q.escrow.analysis.run.v2 to escrow.saga with key analysis.run.v1
[RabbitMQ] Bound q.remit.aggregate to remit.saga with key cycle.aggregate.v1
[RabbitMQ] Queue declared: q.escrow.events.audit.v2
[RabbitMQ] Queue declared: q.remit.export
[RabbitMQ] Bound q.escrow.events.audit.v2 to escrow.events with key escrow.*
[RabbitMQ] Bound q.remit.export to remit.saga with key cycle.export.v1
[RabbitMQ] Queue declared: q.escrow.dlq.v2
[RabbitMQ] Queue declared: q.remit.settle
[RabbitMQ] Bound q.escrow.dlq.v2 to escrow.dlq with key #
[RabbitMQ] Bound q.remit.settle to remit.saga with key cycle.settle.v1
[RabbitMQ] Queue declared: q.remit.aggregate
[RabbitMQ] Queue declared: q.remit.events.audit
[RabbitMQ] Bound q.remit.aggregate to remit.saga with key cycle.aggregate.v1
[RabbitMQ] Bound q.remit.events.audit to remit.events with key remit.*
[RabbitMQ] Queue declared: q.remit.export
[RabbitMQ] Queue declared: q.remit.dlq
[RabbitMQ] Bound q.remit.export to remit.saga with key cycle.export.v1
[RabbitMQ] Bound q.remit.dlq to remit.dlq with key #
[RabbitMQ] Queue declared: q.remit.settle
[RabbitMQ] Queue declared: compliance.regulatory
[RabbitMQ] Bound q.remit.settle to remit.saga with key cycle.settle.v1
[RabbitMQ] Bound compliance.regulatory to compliance.topic with key compliance.regulatory.*
[RabbitMQ] Queue declared: q.remit.events.audit
[RabbitMQ] Queue declared: compliance.investor
[RabbitMQ] Bound q.remit.events.audit to remit.events with key remit.*
[RabbitMQ] Bound compliance.investor to compliance.topic with key compliance.investor.*
[RabbitMQ] Queue declared: q.remit.dlq
[RabbitMQ] Queue declared: compliance.internal
[RabbitMQ] Bound q.remit.dlq to remit.dlq with key #
[RabbitMQ] Bound compliance.internal to compliance.topic with key compliance.internal.*
[RabbitMQ] Queue declared: compliance.regulatory
[RabbitMQ] Queue declared: investor.calc.p10
[RabbitMQ] Bound compliance.regulatory to compliance.topic with key compliance.regulatory.*
[RabbitMQ] Bound investor.calc.p10 to investor.direct with key calc.p10
[RabbitMQ] Queue declared: compliance.investor
[RabbitMQ] Queue declared: investor.calc.p5
[RabbitMQ] Bound compliance.investor to compliance.topic with key compliance.investor.*
[RabbitMQ] Bound investor.calc.p5 to investor.direct with key calc.p5
[RabbitMQ] Queue declared: compliance.internal
[RabbitMQ] Queue declared: investor.calc.p1
[RabbitMQ] Bound compliance.internal to compliance.topic with key compliance.internal.*
[RabbitMQ] Bound investor.calc.p1 to investor.direct with key calc.p1
[RabbitMQ] Queue declared: investor.calc.p10
[RabbitMQ] Queue declared: investor.clawback
[RabbitMQ] Bound investor.calc.p10 to investor.direct with key calc.p10
[RabbitMQ] Bound investor.clawback to investor.direct with key clawback
[RabbitMQ] Queue declared: investor.calc.p5
[RabbitMQ] Queue declared: audit.events
[RabbitMQ] Bound investor.calc.p5 to investor.direct with key calc.p5
[RabbitMQ] Bound audit.events to audit.topic with key audit.*
[RabbitMQ] Queue declared: investor.calc.p1
[RabbitMQ] Queue declared: settlement.ach.settle
[RabbitMQ] Bound investor.calc.p1 to investor.direct with key calc.p1
[RabbitMQ] Bound settlement.ach.settle to settlement.topic with key ach.settlement.*
[RabbitMQ] Queue declared: investor.clawback
[RabbitMQ] Queue declared: settlement.ach.return
[RabbitMQ] Bound investor.clawback to investor.direct with key clawback
[RabbitMQ] Bound settlement.ach.return to settlement.topic with key ach.return.*
[RabbitMQ] Queue declared: audit.events
[RabbitMQ] Queue declared: settlement.wire.advice
[RabbitMQ] Bound audit.events to audit.topic with key audit.*
[RabbitMQ] Bound settlement.wire.advice to settlement.topic with key wire.advice.*
[RabbitMQ] Queue declared: settlement.ach.settle
[RabbitMQ] Queue declared: settlement.check.clear
[RabbitMQ] Bound settlement.ach.settle to settlement.topic with key ach.settlement.*
[RabbitMQ] Bound settlement.check.clear to settlement.topic with key check.clear.*
[RabbitMQ] Queue declared: settlement.ach.return
[RabbitMQ] Queue declared: reconciliation.bank.import
[RabbitMQ] Bound settlement.ach.return to settlement.topic with key ach.return.*
[RabbitMQ] Bound reconciliation.bank.import to bank.topic with key bank.file.*
[RabbitMQ] Queue declared: settlement.wire.advice
[RabbitMQ] Queue declared: reconciliation.match
[RabbitMQ] Bound settlement.wire.advice to settlement.topic with key wire.advice.*
[RabbitMQ] Bound reconciliation.match to reconciliation.topic with key match.*
[RabbitMQ] Queue declared: settlement.check.clear
[RabbitMQ] Queue declared: reconciliation.exceptions
[RabbitMQ] Bound settlement.check.clear to settlement.topic with key check.clear.*
[RabbitMQ] Bound reconciliation.exceptions to reconciliation.topic with key exception.*
[RabbitMQ] Queue declared: reconciliation.bank.import
[RabbitMQ] Queue declared: compliance.hits
[RabbitMQ] Bound reconciliation.bank.import to bank.topic with key bank.file.*
[RabbitMQ] Bound compliance.hits to compliance.topic with key compliance.hit.*
[RabbitMQ] Queue declared: reconciliation.match
[RabbitMQ] Queue declared: aml.screen
[RabbitMQ] Bound reconciliation.match to reconciliation.topic with key match.*
[RabbitMQ] Bound aml.screen to aml.topic with key screen.*
[RabbitMQ] Queue declared: reconciliation.exceptions
[RabbitMQ] Queue declared: aml.review
[RabbitMQ] Bound reconciliation.exceptions to reconciliation.topic with key exception.*
[RabbitMQ] Bound aml.review to aml.topic with key review.*
[RabbitMQ] Queue declared: compliance.hits
[RabbitMQ] Queue declared: dlq.payments
[RabbitMQ] Bound compliance.hits to compliance.topic with key compliance.hit.*
[RabbitMQ] Bound dlq.payments to dlx.main with key payments.dlq
[RabbitMQ] Queue declared: dlq.documents
[RabbitMQ] Queue declared: aml.screen
[RabbitMQ] Bound dlq.documents to dlx.main with key documents.dlq
[RabbitMQ] Bound aml.screen to aml.topic with key screen.*
[RabbitMQ] Queue declared: dlq.notifications
[RabbitMQ] Queue declared: aml.review
[RabbitMQ] Bound dlq.notifications to dlx.main with key notifications.dlq
[RabbitMQ] Bound aml.review to aml.topic with key review.*
[RabbitMQ] Queue declared: dlq.settlement
[RabbitMQ] Queue declared: dlq.payments
[RabbitMQ] Bound dlq.settlement to dlx.main with key settlement.dlq
[RabbitMQ] Bound dlq.payments to dlx.main with key payments.dlq
[RabbitMQ] Queue declared: dlq.reconciliation
[RabbitMQ] Queue declared: dlq.documents
[RabbitMQ] Bound dlq.reconciliation to dlx.main with key reconciliation.dlq
[RabbitMQ] Bound dlq.documents to dlx.main with key documents.dlq
[RabbitMQ] Queue declared: dlq.compliance
[RabbitMQ] Queue declared: dlq.notifications
[RabbitMQ] Bound dlq.compliance to dlx.main with key compliance.dlq
[RabbitMQ] Bound dlq.notifications to dlx.main with key notifications.dlq
[RabbitMQ] Queue declared: dlq.aml
[RabbitMQ] Queue declared: dlq.settlement
[RabbitMQ] Bound dlq.aml to dlx.main with key aml.dlq
[RabbitMQ] Bound dlq.settlement to dlx.main with key settlement.dlq
[RabbitMQ] Queue declared: dlq.servicing.0
[RabbitMQ] Queue declared: dlq.reconciliation
[RabbitMQ] Bound dlq.servicing.0 to dlx.main with key servicing.dlq.0
[RabbitMQ] Bound dlq.reconciliation to dlx.main with key reconciliation.dlq
[RabbitMQ] Queue declared: dlq.servicing.1
[RabbitMQ] Queue declared: dlq.compliance
[RabbitMQ] Bound dlq.servicing.1 to dlx.main with key servicing.dlq.1
[RabbitMQ] Bound dlq.compliance to dlx.main with key compliance.dlq
[RabbitMQ] Queue declared: dlq.servicing.2
[RabbitMQ] Queue declared: dlq.aml
[RabbitMQ] Bound dlq.servicing.2 to dlx.main with key servicing.dlq.2
[RabbitMQ] Bound dlq.aml to dlx.main with key aml.dlq
[RabbitMQ] Queue declared: dlq.servicing.3
[RabbitMQ] Queue declared: dlq.servicing.0
[RabbitMQ] Bound dlq.servicing.3 to dlx.main with key servicing.dlq.3
[RabbitMQ] Bound dlq.servicing.0 to dlx.main with key servicing.dlq.0
[RabbitMQ] Queue declared: dlq.servicing.4
[RabbitMQ] Queue declared: dlq.servicing.1
[RabbitMQ] Bound dlq.servicing.4 to dlx.main with key servicing.dlq.4
[RabbitMQ] Bound dlq.servicing.1 to dlx.main with key servicing.dlq.1
[RabbitMQ] Queue declared: dlq.servicing.5
[RabbitMQ] Queue declared: dlq.servicing.2
[RabbitMQ] Bound dlq.servicing.5 to dlx.main with key servicing.dlq.5
[RabbitMQ] Bound dlq.servicing.2 to dlx.main with key servicing.dlq.2
[RabbitMQ] Queue declared: dlq.servicing.6
[RabbitMQ] Queue declared: dlq.servicing.3
[RabbitMQ] Bound dlq.servicing.6 to dlx.main with key servicing.dlq.6
[RabbitMQ] Bound dlq.servicing.3 to dlx.main with key servicing.dlq.3
[RabbitMQ] Queue declared: dlq.servicing.7
[RabbitMQ] Queue declared: dlq.servicing.4
[RabbitMQ] Bound dlq.servicing.7 to dlx.main with key servicing.dlq.7
[RabbitMQ] Bound dlq.servicing.4 to dlx.main with key servicing.dlq.4
[RabbitMQ] Queue declared: payments.intake
[RabbitMQ] Queue declared: dlq.servicing.5
[RabbitMQ] Bound payments.intake to payments.topic with key payment.*.received
[RabbitMQ] Bound dlq.servicing.5 to dlx.main with key servicing.dlq.5
[RabbitMQ] Bound payments.intake to payments.topic with key payment.*.validate
[RabbitMQ] Queue declared: dlq.servicing.6
[RabbitMQ] Queue declared: q.payments.processing.v2
[RabbitMQ] Bound dlq.servicing.6 to dlx.main with key servicing.dlq.6
[RabbitMQ] Bound q.payments.processing.v2 to payments.topic with key payment.card.validated
[RabbitMQ] Queue declared: dlq.servicing.7
[RabbitMQ] Bound q.payments.processing.v2 to payments.topic with key payment.ach.validated
[RabbitMQ] Bound dlq.servicing.7 to dlx.main with key servicing.dlq.7
[RabbitMQ] Bound q.payments.processing.v2 to payments.topic with key payment.wire.validated
[RabbitMQ] Queue declared: payments.intake
[RabbitMQ] Queue declared: investor.calculations
[RabbitMQ] Bound payments.intake to payments.topic with key payment.*.received
[RabbitMQ] Bound investor.calculations to investor.direct with key calc.*
[RabbitMQ] Bound payments.intake to payments.topic with key payment.*.validate
[RabbitMQ] Queue declared: q.forecast.v2
[RabbitMQ] Queue declared: q.payments.processing.v2
[RabbitMQ] Bound q.forecast.v2 to escrow.saga with key forecast.request
[RabbitMQ] Bound q.payments.processing.v2 to payments.topic with key payment.card.validated
[RabbitMQ] Bound q.forecast.v2 to escrow.saga with key forecast.retry
[RabbitMQ] Bound q.payments.processing.v2 to payments.topic with key payment.ach.validated
[RabbitMQ] Queue declared: q.schedule.disbursement.v2
[RabbitMQ] Bound q.payments.processing.v2 to payments.topic with key payment.wire.validated
[RabbitMQ] Bound q.schedule.disbursement.v2 to escrow.saga with key disbursement.schedule
[RabbitMQ] Queue declared: investor.calculations
[RabbitMQ] Bound q.schedule.disbursement.v2 to escrow.saga with key disbursement.retry
[RabbitMQ] Bound investor.calculations to investor.direct with key calc.*
[RabbitMQ] Queue declared: q.escrow.analysis.v2
[RabbitMQ] Queue declared: q.forecast.v2
[RabbitMQ] Bound q.forecast.v2 to escrow.saga with key forecast.request
[RabbitMQ] Bound q.escrow.analysis.v2 to escrow.saga with key analysis.request
[RabbitMQ] Bound q.escrow.analysis.v2 to escrow.saga with key analysis.retry
[RabbitMQ] Bound q.forecast.v2 to escrow.saga with key forecast.retry
[RabbitMQ] Queue declared: escrow.operations
[RabbitMQ] Queue declared: q.schedule.disbursement.v2
[RabbitMQ] Bound escrow.operations to escrow.workflow with key escrow.*
[RabbitMQ] Bound q.schedule.disbursement.v2 to escrow.saga with key disbursement.schedule
[RabbitMQ] Queue declared: dlq.general
[RabbitMQ] Bound q.schedule.disbursement.v2 to escrow.saga with key disbursement.retry
[RabbitMQ] Bound dlq.general to dlx.main with key *.dlq
[RabbitMQ] Topology applied successfully (with warnings for existing queues)
[RabbitMQ] Topology setup complete using admin channel
[RabbitMQ] Queue declared: q.escrow.analysis.v2
[RabbitMQ] Successfully connected and topology applied
[RabbitMQ] Topology stats: {
  exchanges: 25,
  queues: 74,
  quorumQueues: 51,
  lazyQueues: 3,
  dlqs: 16
}
[RabbitMQ] Bound q.escrow.analysis.v2 to escrow.saga with key analysis.request
[RabbitMQ] Bound q.escrow.analysis.v2 to escrow.saga with key analysis.retry
[RabbitMQ] Queue declared: escrow.operations
[RabbitMQ] Bound escrow.operations to escrow.workflow with key escrow.*
[RabbitMQ] Queue declared: dlq.general
[RabbitMQ] Bound dlq.general to dlx.main with key *.dlq
[RabbitMQ] Topology applied successfully (with warnings for existing queues)
[RabbitMQ] Topology setup complete using admin channel
[RabbitMQ] Connection ready
[Consumers] RabbitMQ connected
[OutboxPublisher] Starting outbox publisher...
[RabbitMQ] Successfully connected and topology applied
[RabbitMQ] Topology stats: {
  exchanges: 25,
  queues: 74,
  quorumQueues: 51,
  lazyQueues: 3,
  dlqs: 16
}
[Consumers] Outbox publisher started
[Validator] Starting payment validator consumer
[RabbitMQ] Created consumer channel for validator-consumer with prefetch 50
[RabbitMQ] Consumer started: validator-consumer on queue payments.validation
[Validator] Consumer started successfully
[Consumers] Validator consumer started
[Classifier] Starting payment classifier consumer
[RabbitMQ] Created consumer channel for classifier-consumer with prefetch 25
[RabbitMQ] Consumer started: classifier-consumer on queue q.classify
[Classifier] Consumer started successfully
[Consumers] Classifier consumer started
[RulesEngine] Starting rules engine consumer
[RabbitMQ] Created consumer channel for rules-engine-consumer with prefetch 10
[RabbitMQ] Consumer started: rules-engine-consumer on queue q.rules.post
[RulesEngine] Consumer started successfully
[Consumers] Rules engine consumer started
[RabbitMQ] Created consumer channel for payment-validation-consumer with prefetch 10
[RabbitMQ] Consumer started: payment-validation-consumer on queue q.validate
[Validation] Payment validation consumer started
[Consumers] Validation consumer started
[RabbitMQ] Created consumer channel for payment-processing-consumer with prefetch 32
[RabbitMQ] Consumer started: payment-processing-consumer on queue q.payments.processing.v2
[Processing] Payment processing consumer started on q.payments.processing.v2
[Consumers] Processing consumer started
[RabbitMQ] Created consumer channel for payment-distribution-consumer with prefetch 10
[RabbitMQ] Consumer started: payment-distribution-consumer on queue payments.distribution
[RabbitMQ] Created consumer channel for payment-clawback-consumer with prefetch 5
[RabbitMQ] Consumer started: payment-clawback-consumer on queue investor.clawback
[Distribution] Payment distribution consumer started
[Consumers] Distribution consumer started
[RabbitMQ] Created consumer channel for payment-reversal-consumer with prefetch 5
[RabbitMQ] Consumer started: payment-reversal-consumer on queue payments.reversal
[RabbitMQ] Created consumer channel for ach-return-consumer with prefetch 5
[RabbitMQ] Consumer started: ach-return-consumer on queue payments.returned
[Reversal] Payment reversal saga started
[Consumers] Reversal saga started
[Consumers] Starting escrow subsystem...
[EscrowManager] Starting escrow subsystem...
[EscrowForecast] Starting forecast consumer
[EscrowDisbursement] Starting disbursement consumer
[EscrowAnalysis] Starting analysis consumer
[RabbitMQ] Created consumer channel for escrow-forecast-consumer with prefetch 10
[RabbitMQ] Created consumer channel for escrow-disbursement-consumer with prefetch 10
[RabbitMQ] Created consumer channel for escrow-analysis-consumer with prefetch 5
[RabbitMQ] Consumer started: escrow-forecast-consumer on queue q.forecast.v2
[EscrowForecast] Consumer started successfully
[RabbitMQ] Consumer started: escrow-disbursement-consumer on queue q.schedule.disbursement.v2
[RabbitMQ] Consumer started: escrow-analysis-consumer on queue q.escrow.analysis.v2
[EscrowDisbursement] Consumer started successfully
[EscrowAnalysis] Consumer started successfully
[EscrowCycle] Daily cycle scheduled for 2025-08-28T02:00:00.000Z
[EscrowCycle] Will run in 1244 minutes
[EscrowManager] Escrow subsystem started successfully
[Consumers] Escrow subsystem started successfully
[Consumers] All payment processing consumers started successfully
[Server] Payment consumers started successfully
[Metrics] Metric collectors initialized
[MetricsCollector] Started periodic metrics collection
[Server] Metrics collection started
[CRM] Running notification checks...
[Server] CRM notification checks scheduled (hourly)
[CRM] Found 0 overdue tasks to notify
[CRM] Found 0 appointments to remind
[CRM] Notification checks complete
The `fetchConnectionCache` option is deprecated (now always `true`)
[RemittanceScheduler] Processing cycles...
[RemittanceScheduler] Started. Next run in 21 hours at 2 AM
[Server] Remittance scheduler started successfully
[Column] API credentials not configured
[Routes] Registered Column banking routes
[Routes] Registered escrow subsystem routes
[Routes] Registered document generation routes
[Routes] Registered cash management routes
[Routes] Registered cash management routes
[Routes] Registered investor remittance routes
5:16:13 AM [express] serving on port 5000
[RemittanceScheduler] Cycle processing complete
5:16:26 AM [express] GET /api/user 304 in 153ms :: {"id":17,"username":"borrower","email":"borrower@‚Ä¶
5:16:26 AM [express] GET /api/user 304 in 158ms :: {"id":17,"username":"borrower","email":"borrower@‚Ä¶
5:16:26 AM [express] GET /api/loans/metrics 200 in 265ms :: {"totalPortfolio":"0","activeLoans":0,"d‚Ä¶
5:16:27 AM [express] GET /api/loans/metrics 304 in 283ms :: {"totalPortfolio":"0","activeLoans":0,"d‚Ä¶
Session without userId: sg3l7B2oJQ-bvBIfkrrxKmkTjIjuSI8v
User borrower logged out successfully
5:29:55 AM [express] POST /api/logout 200 in 138ms
5:29:55 AM [express] GET /api/user 401 in 1ms
5:29:57 AM [express] GET /api/user 401 in 1ms
5:30:01 AM [express] GET /api/user 401 in 1ms
Login attempt for: borrower
Session ID before auth: dE0kjGG_-Henc131qW5Z0yU-zJm4Ct79
Session cookie settings: {
  secure: false,
  httpOnly: true,
  maxAge: 86400000,
  sameSite: 'strict',
  domain: undefined
}
User borrower logged in successfully with role: borrower
Session ID after login: pZJHB66tQe-Hri87VRBj30wpa7kBV3c1
Session data: Session {
  cookie: {
    path: '/',
    _expires: 2025-08-28T05:30:10.968Z,
    originalMaxAge: 86400000,
    httpOnly: true,
    secure: false,
    sameSite: 'strict',
    domain: undefined
  },
  passport: { user: 17 }
}
Response headers about to be sent
Session saved, sending response
5:30:11 AM [express] POST /api/login 200 in 304ms :: {"id":17,"username":"borrower","email":"borrowe‚Ä¶
[API] Error fetching borrower dashboard: {
  name: 'TypeError',
  message: 'Cannot convert undefined or null to object',
  stack: 'TypeError: Cannot convert undefined or null to object\n' +
    '    at Function.entries (<anonymous>)\n' +
    '    at orderSelectedFields (/home/runner/workspace/node_modules/src/utils.ts:77:16)\n' +
    '    at <anonymous> (/home/runner/workspace/node_modules/src/utils.ts:88:19)\n' +
    '    at Array.reduce (<anonymous>)\n' +
    '    at orderSelectedFields (/home/runner/workspace/node_modules/src/utils.ts:77:32)\n' +
    '    at <anonymous> (/home/runner/workspace/node_modules/src/pg-core/query-builders/select.ts:979:23)\n' +
    '    at Object.startActiveSpan (/home/runner/workspace/node_modules/src/tracing.ts:27:11)\n' +
    '    at PgSelectBase._prepare (/home/runner/workspace/node_modules/src/pg-core/query-builders/select.ts:978:17)\n' +
    '    at <anonymous> (/home/runner/workspace/node_modules/src/pg-core/query-builders/select.ts:1009:16)\n' +
    '    at Object.startActiveSpan (/home/runner/workspace/node_modules/src/tracing.ts:27:11)\n' +
    '    at PgSelectBase.execute (/home/runner/workspace/node_modules/src/pg-core/query-builders/select.ts:1008:17)\n' +
    '    at PgSelectBase.then (/home/runner/workspace/node_modules/src/query-promise.ts:31:15)\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)'
}
5:30:11 AM [express] GET /api/borrower/dashboard 500 in 230ms :: {"error":"Failed to fetch dashboard‚Ä¶
5:30:15 AM [express] GET /api/user 304 in 156ms :: {"id":17,"username":"borrower","email":"borrower@‚Ä¶
[API] Error fetching borrower dashboard: {
  name: 'TypeError',
  message: 'Cannot convert undefined or null to object',
  stack: 'TypeError: Cannot convert undefined or null to object\n' +
    '    at Function.entries (<anonymous>)\n' +
    '    at orderSelectedFields (/home/runner/workspace/node_modules/src/utils.ts:77:16)\n' +
    '    at <anonymous> (/home/runner/workspace/node_modules/src/utils.ts:88:19)\n' +
    '    at Array.reduce (<anonymous>)\n' +
    '    at orderSelectedFields (/home/runner/workspace/node_modules/src/utils.ts:77:32)\n' +
    '    at <anonymous> (/home/runner/workspace/node_modules/src/pg-core/query-builders/select.ts:979:23)\n' +
    '    at Object.startActiveSpan (/home/runner/workspace/node_modules/src/tracing.ts:27:11)\n' +
    '    at PgSelectBase._prepare (/home/runner/workspace/node_modules/src/pg-core/query-builders/select.ts:978:17)\n' +
    '    at <anonymous> (/home/runner/workspace/node_modules/src/pg-core/query-builders/select.ts:1009:16)\n' +
    '    at Object.startActiveSpan (/home/runner/workspace/node_modules/src/tracing.ts:27:11)\n' +
    '    at PgSelectBase.execute (/home/runner/workspace/node_modules/src/pg-core/query-builders/select.ts:1008:17)\n' +
    '    at PgSelectBase.then (/home/runner/workspace/node_modules/src/query-promise.ts:31:15)\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)'
}
5:30:15 AM [express] GET /api/borrower/dashboard 500 in 207ms :: {"error":"Failed to fetch dashboard‚Ä¶