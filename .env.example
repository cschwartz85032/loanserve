# Database Configuration
DATABASE_URL=postgresql://user:password@host:port/database

# Session Configuration (REQUIRED in production)
SESSION_SECRET=your-secure-random-session-secret-here
NODE_ENV=development

# RabbitMQ Configuration (REQUIRED)
CLOUDAMQP_URL=amqps://username:password@host/vhost

# Column Banking API Configuration (REQUIRED for payments)
COLUMN_API_BASE=https://api.column.com
COLUMN_API_KEY=placeholder
COLUMN_WEBHOOK_SECRET=placeholder

# Storage Configuration
ARTIFACT_STORE_BUCKET=s3://loanserve-artifacts

# Feature Flags
PAYMENTS_FEATURE_FLAG=true
PAYMENT_RECONCILE_ENABLED=true
PAYMENT_WEBHOOK_ENABLED=true

# Scheduled Jobs
PAYMENTS_RECONCILE_CRON=0 */15 * * * *

# Optional: Cookie domain for production
# COOKIE_DOMAIN=.yourdomain.com

# Port Configuration
PORT=5000

# API Keys
SENDGRID_API_KEY=your-sendgrid-api-key
OPENAI_API_KEY=your-openai-api-key
XAI_API_KEY=your-xai-api-key
GROQ_API_KEY=your-groq-api-key

# Object Storage (if configured)
DEFAULT_OBJECT_STORAGE_BUCKET_ID=
PUBLIC_OBJECT_SEARCH_PATHS=
PRIVATE_OBJECT_DIR=

# Payment System Configuration
PAYMENT_DEFAULT_CHANNEL=LOCKBOX                # ACH|CARD|LOCKBOX|MANUAL
PAYMENT_MIN_TO_POST=25.00                      # otherwise go to suspense (unless ≥ total due)
PAYMENT_SUSPENSE_ACCOUNT=2200                  # GL Suspense liability

# ACH webhooks (bank/NACHA aggregator)
ACH_WEBHOOK_SECRET=                            # HMAC secret for verification
ACH_TIMEOUT_MS=15000

# Lockbox CSV format
LOCKBOX_CSV_HEADER=PaymentDate,LoanNumber,Amount,Reference,Channel
LOCKBOX_DATE_FORMAT=YYYY-MM-DD

# Receipts (PDF)
RCPT_PDF_HEADER=LoanServe • Payment Receipt
RCPT_PDF_WATERMARK=LoanServe
RCPT_S3_PREFIX=receipts

# NSF / chargeback
NSF_FEE=35.00
NSF_FEE_CODE=NSF
NSF_GRACE_DAYS_REAPPLY=3

# GL accounts
GL_CASH_ACCT=1000
GL_LOAN_PRINCIPAL_ACCT=1100
GL_INTEREST_INCOME_ACCT=4000
GL_ESCROW_LIABILITY_ACCT=2100
GL_FEE_INCOME_ACCT=4100
GL_SUSPENSE_ACCT=2200

# Reconciliation
RECON_S3_PREFIX=recon

# Investor Remittance Configuration
REMIT_CADENCE=MONTHLY                 # MONTHLY | WEEKLY
REMIT_CUTOFF_BUSINESS_TZ=America/New_York
REMIT_GRACE_DAYS_BUSINESS=2           # grace after EOM before cutoff; weekly uses Fri cutoff + 2 biz days

# Servicing fee & strip (defaults; can be overridden per-investor/loan)
REMIT_SVC_FEE_BPS=50                  # 50 bps annualized on UPB (monthly pro-rata)
REMIT_STRIP_BPS=0                     # additional IO strip bps on UPB (monthly pro-rata)
REMIT_ALLOW_NETTING=true              # true: P&I net of svc fee; false: fee separate

# Escrow handling
REMIT_PASS_ESCROW=false               # false: do not remit escrow; true: pass-through (for some contracts)

# Output artifacts
REMIT_S3_PREFIX=remittances
REMIT_PDF_HEADER=LoanServe • Investor Remittance Statement
REMIT_PDF_WATERMARK=LoanServe

# Webhooks (optional)
INVESTOR_WEBHOOK_URL=
INVESTOR_WEBHOOK_SECRET=
INVESTOR_WEBHOOK_TIMEOUT_MS=15000

# GL accounts for investor remittances
GL_INVESTOR_PAYABLE_ACCT=2300
GL_SERVICING_FEE_INCOME_ACCT=4200
GL_PRINCIPAL_CLEARING_ACCT=1150

# Reliability & Disaster Recovery Configuration
RPO_MINUTES=5                                 # Data loss target (5 minutes)
RTO_MINUTES=30                                # Service restore target (30 minutes)

# Backup Configuration
BACKUP_BUCKET=loanserve-backups
BACKUP_PREFIX=prod
BACKUP_CRON_PG_LOGICAL=0 3 * * *             # 03:00 UTC nightly
BACKUP_CRON_RMQ=15 3 * * *                   # 03:15 UTC nightly
BACKUP_CRON_VAULT=30 3 * * *                 # 03:30 UTC nightly
BACKUP_CRON_S3_MANIFEST=45 3 * * *           # 03:45 UTC nightly
BACKUP_ENCRYPTION_KMS_ARN=arn:aws:kms:us-east-1:123456789012:key/aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee
BACKUP_PG_PARALLEL_JOBS=4

# PostgreSQL PITR (AWS RDS Aurora/Postgres)
RDS_CLUSTER_ID=loanserve-prod-aurora
RDS_SNAPSHOT_RETENTION_DAYS=35

# Disaster Recovery staging target
DR_DB_URL=postgres://dr_user:dr_pass@dr-host:5432/loanserve_dr
DR_RESTORE_CRON=0 6 * * 6                    # Saturday 06:00 UTC
DR_SMOKE_URL=https://dr.loanserve.io/healthz
DR_SMOKE_TIMEOUT_MS=600000

# Blue/Green Deployment
DEPLOY_STRATEGY=bluegreen
MAINTENANCE_BANNER="System upgrade in progress"
FEATURE_FLAGS_JSON={"export_mapper_v2": false, "ai_provider_openai": false}

# Terraform state bucket
TF_STATE_BUCKET=loanserve-tfstate

# Health Check Configuration
HEALTH_CHECK_TIMEOUT_MS=30000
HEALTH_CHECK_DB_TIMEOUT_MS=5000
HEALTH_CHECK_EXTERNAL_TIMEOUT_MS=10000

# Analytics Lakehouse Configuration
LAKE_BUCKET=loanserve-lake
LAKE_PREFIX=prod

# ETL Scheduling
ETL_HOURLY_CRON=15 * * * *                   # Hourly incremental ETL
ETL_NIGHTLY_CRON=0 2 * * *                   # 02:00 UTC full refresh ETL

# Reporting Schema
REPORTING_SCHEMA=reporting

# PII Governance
ETL_PII_REDACT=true                          # Redact emails/phones in lake
ETL_MAX_LOOKBACK_DAYS=3650                   # 10 years data retention

# dbt Configuration (optional)
DBT_TARGET=prod
DBT_PROFILES_DIR=./analytics/dbt

# External Vendor Integrations - Step 20

# UCDP / SSR (Appraisal Services)
UCDP_BASE_URL=https://api.ucdp.sandbox
UCDP_API_KEY=your_ucdp_api_key_here
UCDP_TIMEOUT_MS=15000

# Flood Determination Services (e.g., CoreLogic/NFIP proxy)
FLOOD_BASE_URL=https://api.flood.sandbox
FLOOD_API_KEY=your_flood_api_key_here
FLOOD_TIMEOUT_MS=12000

# Title Verification Services
TITLE_BASE_URL=https://api.title.sandbox
TITLE_API_KEY=your_title_api_key_here
TITLE_TIMEOUT_MS=12000

# Homeowner's Insurance (HOI) Verification
HOI_BASE_URL=https://api.hoi.sandbox
HOI_API_KEY=your_hoi_api_key_here
HOI_TIMEOUT_MS=12000

# Vendor Configuration
VENDOR_CACHE_TTL_MIN=1440
VENDOR_MAX_RETRIES=3

# Public Developer API - Step 21

# OAuth2 Configuration
PUBLIC_API_BASE=https://api.loanserve.io
OAUTH_ISSUER=loanserve-auth
OAUTH_JWT_SIGNING_KID=api-key-1
OAUTH_JWT_PRIVATE_PEM_PATH=/secrets/oauth_private.pem
OAUTH_JWT_PRIVATE_KEY=development-jwt-secret-key

# API Key Configuration
API_KEY_TTL_DAYS=365

# Rate Limiting
RATE_LIMIT_REQ_PER_MIN=600
RATE_LIMIT_BURST=100

# AI Pipeline Optimization - Step 22

# AI Model Monitoring
AI_DRIFT_THRESHOLD=0.1
AI_PERFORMANCE_BUFFER_SIZE=100
AI_METRICS_FLUSH_INTERVAL_MS=30000

# Auto-Scaling Configuration
AUTO_SCALING_ENABLED=false
SCALING_MIN_INSTANCES=1
SCALING_MAX_INSTANCES=10
SCALING_TARGET_CPU_PERCENT=60
SCALING_COOLDOWN_PERIOD_MS=300000

# Resource Monitoring Thresholds
RESOURCE_CPU_WARNING=70
RESOURCE_CPU_CRITICAL=90
RESOURCE_MEMORY_WARNING=80
RESOURCE_MEMORY_CRITICAL=95
RESOURCE_QUEUE_WARNING=100
RESOURCE_QUEUE_CRITICAL=200

# Cache Optimization
CACHE_AI_RESPONSE_TTL=3600
CACHE_VENDOR_DATA_TTL=86400
CACHE_DOCUMENT_ANALYSIS_TTL=7200
CACHE_MAX_SIZE_AI=10000
CACHE_MAX_SIZE_VENDOR=5000
CACHE_MAX_SIZE_DOCUMENT=1000

# Distributed Tracing
TRACING_ENABLED=true
TRACING_SAMPLE_RATE=0.1
TRACING_BUFFER_SIZE=100
TRACING_FLUSH_INTERVAL_MS=30000

# Performance Targets
TARGET_AI_LATENCY_MS=2000
TARGET_PIPELINE_THROUGHPUT_DPH=1000
TARGET_CACHE_HIT_RATE=0.8
TARGET_ERROR_RATE=0.01